"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function render(e,t){if(t.$content)_render(e,t.$content);else{var n=document.createComment(PLACEHOLDER_CONTENT);t.appendChild(n),_render(e,n),t.$content=n}}function destroy(e){e instanceof HtmlTemplate?e.destroy():e instanceof HtmlTemplateCollection?e.destroy():e.parentNode&&e.parentNode.removeChild(e)}function _render(e,t){e instanceof HtmlTemplate?_renderHtmlTemplate(e,t):e instanceof HtmlTemplateCollection?_renderHtmlTemplateCollection(e,t):_renderText(e,t)}function getFirstNodeFromTemplate(e,t){return e instanceof HtmlTemplate?e.nodeTree[0]:e instanceof HtmlTemplateCollection?getFirstNodeFromTemplate(e.htmlTemplates[e.keys[0]],t):t.$content}function _renderHtmlTemplateCollection(e,t){var n={},o={},r=[],i=t.$content;!i||i instanceof HtmlTemplateCollection||(destroy(i),i=null),i&&(r=i.keys,o=i.placeHolders),r.forEach(function(t){if(e.keys.indexOf(t)<0){removePlaceholder(o[t])}}),e.keys.reduceRight(function(r,a,l,c){var s=e.htmlTemplates[a],u=document.createComment(PLACEHOLDER_CONTENT);if(o[a]&&(u=o[a]),u.nextSibling?u.nextSibling!=r&&t.parentNode.insertBefore(u,r):t.parentNode.insertBefore(u,r),n[a]=u,o[a]){var m=i.htmlTemplates[a];_render(s,u),m instanceof HtmlTemplate&&s instanceof HtmlTemplate&&m.key==s.key&&(e.htmlTemplates[a]=m)}else _render(s,u);return getFirstNodeFromTemplate(e.htmlTemplates[a],u)},t),e.placeHolders=n,t.$content=e}function removePlaceholder(e){e.$content instanceof HtmlTemplate?e.$content.nodeTree.forEach(function(e){return e.parentNode.removeChild(e)}):Array.isArray(e.$content)&&e.$content.forEach(function(e){return removePlaceholder(e)}),e.parentNode.removeChild(e)}function _renderHtmlTemplate(e,t){t.$content?t.$content instanceof HtmlTemplate?(t.$content.applyValues(e.values),t.$content.nodeTree.reduceRight(function(e,t,n){return t.nextSibling&&t.nextSibling!=e&&e.parentNode&&e.parentNode.insertBefore(t,e),t},t)):(destroy(t.$content),e.generateNodeTree().forEach(function(e){return t.parentNode.insertBefore(e,t)}),t.$content=e):(e.generateNodeTree().forEach(function(e){return t.parentNode.insertBefore(e,t)}),t.$content=e)}function _renderText(e,t){if(null!=t.parentNode){t.$content&&destroy(t.$content);var n=document.createTextNode(e);t.parentNode.insertBefore(n,t),t.$content=n}}function html(e){for(var t=arguments.length,n=Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];return new HtmlTemplate(e,n)}function htmlMap(e,t,n){return new HtmlTemplateCollection(e,t,n)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),PLACEHOLDER_CONTENT="âˆž",PLACEHOLDER="\x3c!--"+PLACEHOLDER_CONTENT+"--\x3e",isMinimizationAttribute=function(e){return["checked","compact","declare","defer","disabled","ismap","noresize","noshade","nowrap","selected"].indexOf(e.nodeName)>=0},_cache={},HtmlTemplateCollection=function(){function e(t,n,o){_classCallCheck(this,e),this.items=t,this.keyFn="function"==typeof n?n:function(e){return e[n]},this.templateFn=o,this.keys=[],this.htmlTemplates={},this._init()}return _createClass(e,[{key:"_init",value:function(){var e=this;this.items.forEach(function(t,n,o){var r=e.keyFn.apply(e,[t]),i=e.templateFn.apply(e,[t,n,o]);e.htmlTemplates[r]=i,e.keys.push(r)})}},{key:"destroy",value:function(){var e=this;this.keys.forEach(function(t){e.htmlTemplates[t]instanceof HtmlTemplate&&(e.htmlTemplates[t].destroy(),e.placeHolders[t].parentNode.removeChild(e.placeHolders[t]))}),this.keys=[],this.htmlTemplates={},this.items={},delete this.placeHolders}}]),e}(),HtmlTemplate=function(){function e(t,n){_classCallCheck(this,e),this.strings=t,this.values=n,this.key=this.strings.join("")}return _createClass(e,[{key:"generateNodeTree",value:function(){var e=this.key;if(!(e in _cache)){var t=document.createElement("template");t.innerHTML=this.strings.join(PLACEHOLDER),_cache[e]=t}return this.content=_cache[e].content.cloneNode(!0),this._init(),this.nodeTree=Array.from(this.content.childNodes),this.nodeTree}},{key:"_init",value:function(){var e=[];this._lookDynamicNodes(Array.from(this.content.childNodes),e),this.dynamicNodes=e,this.applyValues(this.values)}},{key:"_lookDynamicNodes",value:function(e,t){var n=this;e.forEach(function(e){e instanceof Comment&&e.nodeValue==PLACEHOLDER_CONTENT?t.push(e):e.attributes&&(Array.from(e.attributes).reduce(function(e,t){if(t.nodeValue.indexOf(PLACEHOLDER)>=0)for(var n=t.nodeValue.split(PLACEHOLDER).length-1,o=0;o<n;o++)t.$dynamicAttributeLength=n,t.$dynamicAttributeLengthPos=0,e.push(t);return e},t),n._lookDynamicNodes(Array.from(e.childNodes),t))})}},{key:"applyValues",value:function(t){this.dynamicNodes.forEach(function(n,o){n.nodeType===Node.ATTRIBUTE_NODE?e._applyAttributeNode(n,t[o]):_render(t[o],n)})}},{key:"destroy",value:function(){this.nodeTree.forEach(function(e){return e.parentNode.removeChild(e)}),this.content=null}}],[{key:"_applyAttributeNode",value:function(e,t){"function"==typeof t&&0===e.name.indexOf("on")?(e.nodeValue=PLACEHOLDER_CONTENT,e.ownerElement[e.name]=t):(e.$valueOriginal||(e.$valueOriginal=e.value),e.$dynamicAttributeLengthPos==e.$dynamicAttributeLength&&(e.$dynamicAttributeLengthPos=0),0==e.$dynamicAttributeLengthPos&&(e.$value=e.$valueOriginal),isMinimizationAttribute(e)?e.ownerElement[e.nodeName]=t:(e.$value=e.$value.split(PLACEHOLDER).reduce(function(e,n,o){return 0==o?n:""+e+(1==o?t:PLACEHOLDER)+n},""),++e.$dynamicAttributeLengthPos==e.$dynamicAttributeLength&&e.value!=e.$value&&(e.value=e.$value)))}}]),e}();