"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function render(e,t){if(t.$content)_render(e,t.$content);else{var n=document.createComment(PLACEHOLDER_CONTENT);t.appendChild(n),_render(e,n),t.$content=n}}function destroy(e){e instanceof HtmlTemplate?e.destroy():e instanceof HtmlTemplateCollection?e.destroy():e.parentNode&&e.parentNode.removeChild(e)}function _render(e,t){e instanceof HtmlTemplate?_renderHtmlTemplate(e,t):e instanceof HtmlTemplateCollection?_renderHtmlTemplateCollection(e,t):_renderText(e,t)}function getFirstNodeFromTemplate(e,t){return e instanceof HtmlTemplate?e.nodeTree[0]:e instanceof HtmlTemplateCollection?getFirstNodeFromTemplate(e.htmlTemplates[e.keys[0]],t):t.$content}function _renderHtmlTemplateCollection(e,t){var n={},r={},o=t.$content;!o||o instanceof HtmlTemplateCollection||(destroy(o),o=null),o&&(r=o.placeHolders,o.keys.forEach(function(t){if(e.keys.indexOf(t)<0){removePlaceholder(r[t])}})),e.keys.reduceRight(function(a,i,l,c){var s=e.htmlTemplates[i],u=document.createComment(PLACEHOLDER_CONTENT);if(r[i]&&(u=r[i]),u.nextSibling?u.nextSibling!=a&&t.parentNode.insertBefore(u,a):t.parentNode.insertBefore(u,a),n[i]=u,r[i]){var m=o.htmlTemplates[i];_render(s,u),m instanceof HtmlTemplate&&s instanceof HtmlTemplate&&m.key==s.key&&(e.htmlTemplates[i]=m)}else _render(s,u);return getFirstNodeFromTemplate(e.htmlTemplates[i],u)},t),e.placeHolders=n,t.$content=e}function removePlaceholder(e){e.$content instanceof HtmlTemplate?e.$content.nodeTree.forEach(function(e){return e.parentNode.removeChild(e)}):Array.isArray(e.$content)&&e.$content.forEach(function(e){return removePlaceholder(e)}),e.parentNode.removeChild(e)}function _renderHtmlTemplate(e,t){t.$content?t.$content instanceof HtmlTemplate?(t.$content.applyValues(e.values),t.$content.nodeTree.reduceRight(function(e,t,n){return t.nextSibling&&t.nextSibling!=e&&e.parentNode&&e.parentNode.insertBefore(t,e),t},t)):(destroy(t.$content),e.generateNodeTree().forEach(function(e){return t.parentNode.insertBefore(e,t)}),t.$content=e):(e.generateNodeTree().forEach(function(e){return t.parentNode.insertBefore(e,t)}),t.$content=e)}function _renderText(e,t){if(null!=t.parentNode){t.$content&&destroy(t.$content);var n=document.createTextNode(e);t.parentNode.insertBefore(n,t),t.$content=n}}function html(e){for(var t=e.join("").replace(/\s/g,""),n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return new HtmlTemplate(e,r,t)}function cache(e){return{html:function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return new HtmlTemplate(t,r,e)}}}function htmlMap(e,t,n){return new HtmlTemplateCollection(e,t,n)}function getPath(e){for(var t=0,n=e;null!=(n=n.previousSibling);)t++;var r=[];return r.push(t),e.parentNode&&e.parentNode.nodeType!=Node.DOCUMENT_FRAGMENT_NODE?r.concat(getPath(e.parentNode)):r}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),PLACEHOLDER_CONTENT="âˆž",PLACEHOLDER="\x3c!--"+PLACEHOLDER_CONTENT+"--\x3e",isMinimizationAttribute=function(e){return["checked","compact","declare","defer","disabled","ismap","noresize","noshade","nowrap","selected"].indexOf(e.nodeName)>=0},_cache={},HtmlTemplateCollection=function(){function e(t,n,r){_classCallCheck(this,e),this.items=t,this.keyFn="function"==typeof n?n:function(e){return e[n]},this.templateFn=r,this.keys=[],this.htmlTemplates={},this._init()}return _createClass(e,[{key:"_init",value:function(){for(var e=this,t=e.items.length;t--;){var n=e.items[t],r=e.keyFn.apply(e,[n]),o=e.templateFn.apply(e,[n,t,e.items]);e.htmlTemplates[r]=o,e.keys.push(r)}e.keys.reverse()}},{key:"destroy",value:function(){var e=this;this.keys.forEach(function(t){e.htmlTemplates[t]instanceof HtmlTemplate&&(e.htmlTemplates[t].destroy(),e.placeHolders[t].parentNode.removeChild(e.placeHolders[t]))}),this.keys=[],this.htmlTemplates={},this.items={},delete this.placeHolders}}]),e}(),HtmlTemplate=function(){function e(t,n,r){_classCallCheck(this,e),this.strings=t,this.values=n,this.key=r}return _createClass(e,[{key:"generateNodeTree",value:function(){var e=this.key;if(!_cache[e]){var t=document.createElement("template");t.innerHTML=this.strings.join(PLACEHOLDER),_cache[e]=t}var n=_cache[e];return this.content=n.content.cloneNode(!0),n.dynamicNodesPath?(this.dynamicNodesPath=n.dynamicNodesPath,this._warmStart()):(this._coldStart(),n.dynamicNodesPath=this.dynamicNodesPath),this.nodeTree=Array.from(this.content.childNodes),this.nodeTree}},{key:"_coldStart",value:function(){var e=[],t=[];this._lookDynamicNodes(Array.from(this.content.childNodes),e,t),this.dynamicNodes=e,this.dynamicNodesPath=t.map(function(e){return e.reverse()}),this.applyValues(this.values)}},{key:"_warmStart",value:function(){this._lookDynamicNodesFromPath(),this.applyValues(this.values)}},{key:"_lookDynamicNodesFromPath",value:function(){var e=this,t=this.dynamicNodesPath.map(function(t){return t.reduce(function(e,t){if("number"==typeof t)return e.childNodes[t];var n=e.attributes[t.name];return n.$dynamicAttributeLength=t.dynamicLength,n.$dynamicAttributeLengthPos=0,n},e.content)});this.dynamicNodes=t}},{key:"_lookDynamicNodes",value:function(e,t,n){var r=this;e.forEach(function(e){e instanceof Comment&&e.nodeValue==PLACEHOLDER_CONTENT?(t.push(e),n.push(getPath(e))):e.attributes&&(Array.from(e.attributes).reduce(function(e,t){if(t.nodeValue.indexOf(PLACEHOLDER)>=0)for(var r=t.nodeValue.split(PLACEHOLDER).length-1,o=0;o<r;o++){t.$dynamicAttributeLength=r,t.$dynamicAttributeLengthPos=0,e.push(t);var a=[{name:t.nodeName,dynamicLength:r}].concat(getPath(t.ownerElement));n.push(a)}return e},t),r._lookDynamicNodes(Array.from(e.childNodes),t,n))})}},{key:"applyValues",value:function(t){this.dynamicNodes.forEach(function(n,r){n.nodeType===Node.ATTRIBUTE_NODE?e._applyAttributeNode(n,t[r]):_render(t[r],n)})}},{key:"destroy",value:function(){this.nodeTree.forEach(function(e){return e.parentNode.removeChild(e)}),this.content=null}}],[{key:"_applyAttributeNode",value:function(e,t){"function"==typeof t&&0===e.name.indexOf("on")?(e.nodeValue=PLACEHOLDER_CONTENT,e.ownerElement[e.name]=t):(e.$valueOriginal||(e.$valueOriginal=e.value),e.$dynamicAttributeLengthPos==e.$dynamicAttributeLength&&(e.$dynamicAttributeLengthPos=0),0==e.$dynamicAttributeLengthPos&&(e.$value=e.$valueOriginal),isMinimizationAttribute(e)?e.ownerElement[e.nodeName]=t:(e.$value=e.$value.split(PLACEHOLDER).reduce(function(e,n,r){return 0==r?n:""+e+(1==r?t:PLACEHOLDER)+n},""),++e.$dynamicAttributeLengthPos==e.$dynamicAttributeLength&&e.value!=e.$value&&(e.value=e.$value)))}}]),e}();