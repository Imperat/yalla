"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function render(e,t){if(!t.$content){var n=document.createComment(PLACEHOLDER_CONTENT);t.appendChild(n),t.$content=n}_render(e,t.$content)}function destroy(e){e instanceof HtmlTemplate?e.destroy():e instanceof HtmlTemplateCollection?e.destroy():e.parentNode&&e.parentNode.removeChild(e)}function _render(e,t){e instanceof HtmlTemplate?_renderHtmlTemplate(e,t):e instanceof HtmlTemplateCollection?_renderHtmlTemplateCollection(e,t):_renderText(e,t)}function getFirstNodeFromTemplate(e,t){return e instanceof HtmlTemplate?e.nodeTree[0]:e instanceof HtmlTemplateCollection?getFirstNodeFromTemplate(e.templateValuesContainer[e.keys[0]],t):t.$content}function _renderHtmlTemplateCollection(e,t){var n={},a={},r=t.$content;r&&(r instanceof HtmlTemplateCollection?(a=r.placeHolderContainer,r.keys.forEach(function(t){e.keys.indexOf(t)<0&&removePlaceholder(a[t])})):(destroy(r),r=null)),e.keys.reduceRight(function(o,i){var l=e.templateValuesContainer[i],c=document.createComment(PLACEHOLDER_CONTENT);if(a[i]){c=a[i];var s=r.templateValuesContainer[i];s instanceof HtmlTemplate&&l instanceof HtmlTemplate&&s.key==l.key&&(e.templateValuesContainer[i]=s)}return c.nextSibling&&c.nextSibling==o||t.parentNode.insertBefore(c,o),n[i]=c,_render(l,c),getFirstNodeFromTemplate(e.templateValuesContainer[i],c)},t),e.placeHolderContainer=n,t.$content=e}function removePlaceholder(e){(e.$content instanceof HtmlTemplate||e.$content instanceof HtmlTemplateCollection)&&e.$content.destroy(),e.parentNode.removeChild(e)}function _buildTemplate(e,t){e.generateNodeTree().forEach(function(e){return t.parentNode.insertBefore(e,t)}),t.$content=e}function _renderHtmlTemplate(e,t){if(t.$content){var n=t.$content;n instanceof HtmlTemplate?(n.applyValues(e.values),n.nodeTree.reduceRight(function(e,t){return t.nextSibling&&t.nextSibling!=e&&e.parentNode&&e.parentNode.insertBefore(t,e),t},t)):(destroy(n),_buildTemplate(e,t))}else _buildTemplate(e,t)}function _renderText(e,t){if(null!=t.parentNode){var n=t.$content;if(n){if(n.nodeType&&n.nodeType===Node.TEXT_NODE){if(n.nodeValue==e)return;return void(n.nodeValue=e)}destroy(n)}var a=document.createTextNode(e);t.parentNode.insertBefore(a,t),t.$content=a}}function html(e){for(var t=e.join("").replace(/\s/g,""),n=arguments.length,a=Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return new HtmlTemplate(e,a,t)}function cache(e){return{html:function(t){for(var n=arguments.length,a=Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];return new HtmlTemplate(t,a,e)}}}function htmlCollection(e,t,n){return new HtmlTemplateCollection(e,t,n)}function getPath(e){for(var t=0,n=e;null!=(n=n.previousSibling);)t++;var a=[];return a.push(t),e.parentNode&&e.parentNode.parentNode?a.concat(getPath(e.parentNode)):a}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),PLACEHOLDER_CONTENT="placeholder",PLACEHOLDER="\x3c!--"+PLACEHOLDER_CONTENT+"--\x3e",isMinimizationAttribute=function(e){return["checked","compact","declare","defer","disabled","ismap","noresize","noshade","nowrap","selected"].indexOf(e.nodeName)>=0},templateRoot={col:"colgroup",td:"tr",area:"map",tbody:"table",tfoot:"table",th:"tr",thead:"table",tr:"tbody",caption:"table",colgroup:"table",li:"ul"},arrayFrom=function(e){for(var t=[],n=e.length;n--;t.unshift(e[n]));return t},_cache={},HtmlTemplateCollection=function(){function e(t,n,a){_classCallCheck(this,e),this.items=t,this.keyFn="function"==typeof n?n:function(e){return e[n]},this.templateFn=a,this.keys=[],this.templateValuesContainer={},this.placeHolderContainer={},this._init()}return _createClass(e,[{key:"_init",value:function(){for(var e=this.items.length;e--;){var t=this.items[e],n=this.keyFn.apply(this,[t]);this.templateValuesContainer[n]=this.templateFn.apply(this,[t,e,this.items]),this.keys.push(n)}this.keys.reverse()}},{key:"destroy",value:function(){var e=this;this.keys.forEach(function(t){e.templateValuesContainer[t]instanceof HtmlTemplate&&(e.templateValuesContainer[t].destroy(),e.placeHolderContainer[t].parentNode.removeChild(e.placeHolderContainer[t]))}),this.keys=[],this.templateValuesContainer={},this.items={},this.placeHolderContainer={}}}]),e}(),HtmlTemplate=function(){function e(t,n,a){_classCallCheck(this,e),this.strings=t,this.values=n,this.key=a}return _createClass(e,[{key:"generateNodeTree",value:function(){var e=this.key;if(!_cache[e]){var t=this._getProperTemplateTag(this.strings.join(PLACEHOLDER).trim());_cache[e]=t}var n=_cache[e],a=n.cloneNode(!0);return n.dynamicNodesPath?(this.dynamicNodesPath=n.dynamicNodesPath,this._warmStart(a)):(this._coldStart(a),n.dynamicNodesPath=this.dynamicNodesPath),this.nodeTree=arrayFrom(a.childNodes),this.nodeTree}},{key:"_getProperTemplateTag",value:function(e){var t=null,n=e.substring(1,e.indexOf(">"));n=(n.indexOf(" ")>0?n.substring(0,n.indexOf(" ")):n).toLowerCase();var a=templateRoot[n];return t=a?document.createElement(a):document.createElement("div"),t.innerHTML=e,t}},{key:"_coldStart",value:function(e){var t=[],n=[];this._lookDynamicNodes(arrayFrom(e.childNodes),t,n),this.dynamicNodes=t,this.dynamicNodesPath=n.map(function(e){return e.reverse()}),this.applyValues(this.values)}},{key:"_warmStart",value:function(e){this.dynamicNodes=this._lookDynamicNodesFromPath(e,this.dynamicNodesPath),this.applyValues(this.values)}},{key:"_lookDynamicNodesFromPath",value:function(e,t){return t.map(function(t){return t.reduce(function(e,t){if("number"==typeof t)return e.childNodes[t];var n=e.attributes[t.name];return n.$dynamicAttributeLength=t.dynamicLength,n.$dynamicAttributeLengthPos=0,n},e)})}},{key:"_lookDynamicNodes",value:function(e,t,n){var a=this;e.forEach(function(e){e instanceof Comment&&e.nodeValue==PLACEHOLDER_CONTENT?(t.push(e),n.push(getPath(e))):e.attributes&&(arrayFrom(e.attributes).reduce(function(e,t){if(t.nodeValue.indexOf(PLACEHOLDER)>=0)for(var a=t.nodeValue.split(PLACEHOLDER).length-1,r=0;r<a;r++){t.$dynamicAttributeLength=a,t.$dynamicAttributeLengthPos=0,e.push(t);var o=[{name:t.nodeName,dynamicLength:a}].concat(getPath(t.ownerElement));n.push(o)}return e},t),a._lookDynamicNodes(arrayFrom(e.childNodes),t,n))})}},{key:"applyValues",value:function(t){this.dynamicNodes.forEach(function(n,a){n.nodeType===Node.ATTRIBUTE_NODE?e._applyAttributeNode(n,t[a]):_render(t[a],n)})}},{key:"destroy",value:function(){this.nodeTree.forEach(function(e){return e.parentNode.removeChild(e)})}}],[{key:"_applyAttributeNode",value:function(e,t){if("function"==typeof t&&0===e.name.indexOf("on")){e.nodeValue=!1;var n=e.name.substring(2,e.name.length);e.ownerElement.addEventListener(n,t)}else e.$valueOriginal||(e.$valueOriginal=e.value),e.$dynamicAttributeLengthPos==e.$dynamicAttributeLength&&(e.$dynamicAttributeLengthPos=0),0==e.$dynamicAttributeLengthPos&&(e.$value=e.$valueOriginal),isMinimizationAttribute(e)?e.ownerElement[e.nodeName]=t:(e.$value=e.$value.split(PLACEHOLDER).reduce(function(e,n,a){return 0==a?n:""+e+(1==a?t:PLACEHOLDER)+n},""),e.$dynamicAttributeLengthPos++,e.$dynamicAttributeLengthPos==e.$dynamicAttributeLength&&e.value!=e.$value&&(e.value=e.$value))}}]),e}();